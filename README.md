# NUST Research and Authors Output

This repository fetches publication metadata from OpenAlex for NUST-affiliated researchers, stores it in SQLite and CSV artifacts, and powers the Power BI dashboards located in `power_bi/`. The workflow produces two data products:

1. Journal vs. conference counts per researcher per year (`scripts/conf_jour_outputs.py`).
2. A detailed author/topic dataset for department dashboards (`scripts/nust_authors.py`).

## Repository layout

- `scripts/conf_jour_outputs.py` - builds the conference vs. journal fact tables and exports `db_csv/nust_conf_jour_output/counts_per_person_year.csv` (the Power BI file consumes the CSV only).
- `scripts/nust_authors.py` - pulls the author/topic data used by `power_bi/Nust_Authors.pbix` and writes to `db_csv/nust_authors/nust_research_authors.sqlite3`.
- `db_csv/nust_conf_jour_output/` - SQLite DB (`nust_research.sqlite3`) plus the CSV consumed by the conference/journal dashboard.
- `db_csv/nust_authors/` - SQLite DB for the author/topic dashboard.
- `power_bi/` - Power BI Desktop files (`Nust_Conf_Jour_Outputs.pbix`, `Nust_Authors.pbix`).
- `requirements.txt` - Python dependencies for the collectors.

## Requirements

- [Python 3.10+](https://www.python.org/downloads/) with `pip` and `venv`.
- [Power BI Desktop](https://www.microsoft.com/en-us/download/details.aspx?id=58494) to open the dashboards.
- A 64-bit SQLite ODBC driver if you need Power BI to connect directly to the SQLite files (required for `Nust_Authors.pbix`, optional for the conference/journal dashboard because it uses the CSV export only).

## Setup

```powershell
git clone https://github.com/SamuelNduw/Research_Output.git
cd Research_Output
python -m venv .venv
.venv\Scripts\activate
pip install -r requirements.txt
```

Key variables:

| Variable | Default | Used by | Purpose |
| --- | --- | --- | --- |
| `OPENALEX_UA` | `NUST-ORCID-Collector/1.0 (contact: 223118001@nust.na)` | both scripts | OpenAlex blocks requests without a descriptive User-Agent; always include a contact email. |
| `NUST_INST_ID` | `I101993903` | both scripts | OpenAlex institution id for NUST. |
| `YEAR_START` | `2023` | `conf_jour_outputs.py` | First publication year (inclusive). |
| `YEAR_END` | `2025` | `conf_jour_outputs.py` | Last publication year (inclusive). |
| `YEAR` | `2025` | `nust_authors.py` | Single year that the author/topic collector targets. |
| `DB_PATH` | `../db_csv/nust_conf_jour_output/nust_research.sqlite3` | `conf_jour_outputs.py` | Location of the SQLite DB for the conference/journal dataset. Override to keep the DB elsewhere. |
| `DB_PATH` | `../db_csv/nust_authors/nust_research_authors.sqlite3` | `nust_authors.py` | Location of the SQLite DB for the author/topic dataset. Set it before running that script. |

Each script reads `DB_PATH` independently; set it to the correct path for the collector you are about to run.

## Running the collectors

### Conference and journal outputs per person per year

1. Activate the virtual environment and ensure the environment variables above are set.
2. Run the collector from the repository root:

   ```powershell
   python scripts/conf_jour_outputs.py 
   ```

3. The script will:
   - Create or refresh the SQLite schema (`authors`, `works`, `fact_authorships_works`, `v_counts_per_person_year`).
   - Pull every ORCID author whose last known affiliation includes NUST.
   - Iterate through each year in `YEAR_START..YEAR_END`, fetch works where NUST is listed in the authorships, and classify the venue as journal or conference.
   - Export `counts_per_person_year.csv`, which is the only table imported into `Nust_Conf_Jour_Outputs.pbix`.

You can rerun the script any time; it performs upserts and will only pull incremental additions from OpenAlex.

### NUST authors and topics dataset

1. Set `YEAR` to the publication year you want to report on.
2. Run:

   ```powershell
   python scripts/nust_authors.py
   ```

3. The script writes `db_csv/nust_authors/nust_research_authors.sqlite3`, which includes the `authors`, `works_2025`, `authorships_2025`, `topics`, and `work_topics_2025` tables. That SQLite database is the source for `Nust_Authors.pbix`.

## Refreshing the Power BI dashboards

### `power_bi/Nust_Conf_Jour_Outputs.pbix`

1. Ensure `db_csv/nust_conf_jour_output/counts_per_person_year.csv` exists (generated by `conf_jour_outputs.py`).
2. Open the PBIX in Power BI Desktop. If prompted, update the CSV path so it points to your local repo.
3. Use **Transform data -> Data source settings** whenever you move the CSV or clone the repo to a new location.
4. Click **Refresh**. The visuals (per-person counts, totals by year, etc.) now reflect the latest OpenAlex pull.

### `power_bi/Nust_Authors.pbix`

1. Run `scripts/nust_authors.py` so that `db_csv/nust_authors/nust_research_authors.sqlite3` is up to date.
2. Install/register a 64-bit SQLite ODBC driver (Control Panel -> Administrative Tools -> ODBC Data Sources (64-bit) -> System DSN -> Add) or use Power BI''s built-in SQLite connector if available.
3. Open `power_bi/Nust_Authors.pbix`, update the data source path/DSN if prompted, then click **Refresh** to pull the latest authorship/topic tables.
4. Use Power BI bookmarks or filters to slice the data by topic domain, department mappings, or author.

## Troubleshooting

- **HTTP errors (403/422)** - double-check that `OPENALEX_UA` includes a contact email and that filters in the scripts have not been edited to unsupported combinations.
- **Rate limiting (429)** - the collectors already back off exponentially, but you can raise `PAGE_SLEEP` in the scripts or reduce the year window when testing.
- **Power BI cannot connect to SQLite** - confirm you are using the 64-bit ODBC driver and that the DSN points to the correct `.sqlite3` files inside `db_csv/`. This applies only to the `Nust_Authors.pbix` file.
- **CSV path moved** - open **Data source settings** in Power BI, highlight the CSV source, click **Change Source**, and browse to the new path.
